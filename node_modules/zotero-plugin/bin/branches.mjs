#!/usr/bin/env node
var __require = /* @__PURE__ */ ((x) => typeof require !== "undefined" ? require : typeof Proxy !== "undefined" ? new Proxy(x, {
  get: (a, b) => (typeof require !== "undefined" ? require : a)[b]
}) : x)(function(x) {
  if (typeof require !== "undefined") return require.apply(this, arguments);
  throw Error('Dynamic require of "' + x + '" is not supported');
});

// bin/branches.ts
import "dotenv/config";
import * as path from "path";
import { Octokit } from "@octokit/rest";

// root.ts
var root_default = process.cwd();

// bin/branches.ts
process.on("unhandledRejection", (up) => {
  throw up;
});
var octokit = new Octokit({ auth: `token ${process.env.GITHUB_TOKEN}` });
var pkg = __require(path.join(root_default, "package.json"));
var [, owner, repo] = pkg.repository.url.match(/:\/\/github.com\/([^/]+)\/([^.]+)\.git$/);
async function main() {
  const branches = await octokit.repos.listBranches({ owner, repo });
  for (const branch of branches.data) {
    if (/^[0-9]+$/.exec(branch.name)) {
      const issue = await octokit.issues.get({ owner, repo, issue_number: parseInt(branch.name) });
      if (issue.data.state !== "open") console.log(branch.name, issue.data.state);
    } else if (!["master", "main", "gh-pages"].includes(branch.name)) {
      console.log(branch.name);
    }
  }
}
main().catch((err) => console.log(err));
